{% extends 'base.html' %}
{% block content %}
<h1>Menú de proyectos (Editar, habilitar o deshabilitar proyecto)</h1>

<!-- Formulario de búsqueda -->
<form method="get" style="margin-top: 20px;">
    {{ task.form.titulo.label_tag }}
    {{ task.form.titulo }}
    
    {{ task.form.estatus.label_tag }}
    {{ task.form.estatus }}
    
    <button type="submit" class="btn btn-primary">Buscar</button>
    <a href="{% url 'task' %}" class="btn btn-secondary">Limpiar filtro</a>
</form>

<!-- Botón dropdown para descargar CSV -->
<div class="dropdown mt-3 mb-3">
    <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownCSV" data-bs-toggle="dropdown" aria-expanded="false">
        Descargar lista de proyectos
    </button>
    <ul class="dropdown-menu" aria-labelledby="dropdownCSV">
        <li><a class="dropdown-item" href="{% url 'descargar_csv' %}?filtro=all">Todos los proyectos</a></li>
        <li><a class="dropdown-item" href="{% url 'descargar_csv' %}?filtro=activos">Proyectos activos</a></li>
        <li><a class="dropdown-item" href="{% url 'descargar_csv' %}?filtro=inactivos">Proyectos inactivos</a></li>
    </ul>
</div>


<!-- Resultados de proyectos -->
<table class="table table-bordered table-striped">
    <thead class="table-dark">
        <tr>
            <th>Título</th>
            <th>Portada</th>
            <th>Estatus</th>
            <th>Descripción</th>
            <th>Subido por</th>
            <th>Fecha de subida</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for Proyecto in task.qs %}
            <tr>
                <td><a href="{% url 'project_edit' Proyecto.id %}">{{ Proyecto.titulo }}</a></td>
                <td>
                    {% if Proyecto.Portada_de_proyecto %}
                        <img src="{{ Proyecto.Portada_de_proyecto.url }}" alt="Portada de {{ Proyecto.titulo }}" style="max-width: 100px;">
                    {% else %}
                        No disponible
                    {% endif %}
                </td>
                <td>
                    {% if Proyecto.Estatus_de_proyecto == 'Si' %}
                        <span class="badge bg-success">Activo</span>
                    {% else %}
                        <span class="badge bg-secondary">Inactivo</span>
                    {% endif %}
                </td>
                <td>{{ Proyecto.descripcion|truncatechars:50 }}</td>
                <td>{{ Proyecto.Empleado_Responsable.first_name }} {{ Proyecto.Empleado_Responsable.last_name }}</td>
                <td>{{ Proyecto.FechaDeAgregado|date:"d M Y" }}</td>
                <td><a href="{% url 'project_edit' Proyecto.id %}" class="btn btn-sm btn-primary">Editar</a></td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="7" class="text-center">No se encontraron proyectos que coincidan con la búsqueda.</td>
            </tr>
        {% endfor %}
    </tbody>
</table>
<br>

{% endblock %}
